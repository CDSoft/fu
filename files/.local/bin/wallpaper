#!/bin/bash

WALLPAPER=%(HOME)/.config/i3/wallpaper.png

black()
{
    convert -size 1x1 xc:black $WALLPAPER
}

plasma()
{
    local color="srgb(2,8,24)"

    convert -size 640x360 \
        plasma:$color-$color \
        -virtual-pixel tile \
        -blur 0x8 \
        $WALLPAPER
}

pixelization()
{
    plasma
    convert $WALLPAPER -scale 10% -scale 1000% $WALLPAPER
}

cyclic()
{
    color="srgb(2,4,12)"

    convert -size 96x96 \
        plasma:$color-$color \
        -virtual-pixel tile \
        -blur 0x8 \
        $WALLPAPER
}

moire()
{
    local WIDTH=$((1*1920))
    local HEIGHT=$((1*1080))

    local X0=$((0))
    local X1=$((WIDTH-1-X0))

    local Y0=$((X0))
    local Y1=$((HEIGHT-1-Y0))

    # background

    local CMD="convert -size ${WIDTH}x${HEIGHT} xc:black -fill '#000000'"

    # background lines

    local CMD="$CMD -stroke '#226644'"

    local N=750

    for i in `seq 0 $N`
    do
        local XA=$(( (X0+X1)/2 ))
        local YA=$Y1
        local XB=`lua -l math -e "print($XA + $WIDTH*math.cos($i*math.pi/$N))"`
        local YB=`lua -l math -e "print($YA - $WIDTH*math.sin($i*math.pi/$N))"`
        CMD="$CMD -draw \"line $XA,$YA $XB,$YB\""
    done

    for i in `seq 0 $N`
    do
        local XA=$(( (X0+X1)/2 ))
        local YA=$Y0
        local XB=`lua -l math -e "print($XA + $WIDTH*math.cos($i*math.pi/$N))"`
        local YB=`lua -l math -e "print($YA + $WIDTH*math.sin($i*math.pi/$N))"`
        CMD="$CMD -draw \"line $XA,$YA $XB,$YB\""
    done

    # foreground line

    CMD="$CMD -stroke '#224488'"

    local N=250

    for i in `seq 0 $N`
    do
        local XA=$(( (i*X0 + (N-i)*X1) / N ))
        local YA=$Y0
        local XB=$X0
        local YB=$(( (i*Y1 + (N-i)*Y0) / N ))
        CMD="$CMD -draw \"line $XA,$YA $XB,$YB\""
    done

    for i in `seq 0 $N`
    do
        local XA=$(( (i*X0 + (N-i)*X1) / N ))
        local YA=$Y1
        local XB=$X0
        local YB=$(( (i*Y0 + (N-i)*Y1) / N ))
        CMD="$CMD -draw \"line $XA,$YA $XB,$YB\""
    done

    for i in `seq 0 $N`
    do
        local XA=$(( (i*X0 + (N-i)*X1) / N ))
        local YA=$Y0
        local XB=$X1
        local YB=$(( (i*Y0 + (N-i)*Y1) / N ))
        CMD="$CMD -draw \"line $XA,$YA $XB,$YB\""
    done

    for i in `seq 0 $N`
    do
        local XA=$(( (i*X0 + (N-i)*X1) / N ))
        local YA=$Y1
        local XB=$X1
        local YB=$(( (i*Y1 + (N-i)*Y0) / N ))
        CMD="$CMD -draw \"line $XA,$YA $XB,$YB\""
    done

    CMD="$CMD -colors 4 $WALLPAPER"

    eval $CMD
}

%( cfg_yesno("wallpaper-plasma", "«plasma» wallpaper?") and "plasma"
or cfg_yesno("wallpaper-pixelized-plasma", "«pixelized plasma» wallpaper ?") and "pixelization"
or cfg_yesno("wallpaper-cyclic-plasma", "«cyclic plasma» wallpaper ?") and "cyclic"
or cfg_yesno("wallpaper-moire", "«moiré» wallpaper ?") and "moire"
or "black" )

DISPLAY=:0 feh --no-fehbg --bg-fill $WALLPAPER
